<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empleados - Tienda de Cómics</title>
    <style>
        /* Estilos generales */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
        }

        /* Estilos del encabezado */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .logo {
            font-weight: 900;
            font-size: 24px;
            display: flex;
            align-items: center;
        }

        .logo::before {
            content: "";
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: black;
            margin-right: 10px;
            clip-path: polygon(0 0, 100% 0, 100% 100%, 50% 70%, 0 100%);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        nav ul li a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
        }

        /* Contenedor principal */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        /* Estilos para la tabla de empleados */
        .employees-table {
            width: 100%;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            margin-top: 20px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
        }

        .add-employee-btn {
            background-color: #e32929;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            text-decoration: none;
        }

        .add-employee-btn:hover {
            background-color: #c72020;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f9f9f9;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        /* Estilos para los avatares de empleados */
        .employee-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e32929;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .employee-name {
            font-weight: 600;
        }

        /* Estilos para los roles de empleados */
        .role-tag {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .role-admin {
            background-color: #4a6cf7;
        }

        .role-vendedor {
            background-color: #38b653;
        }

        .role-almacen {
            background-color: #e6a919;
        }

        /* Estilos para los estados de empleados */
        .status-tag {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background-color: #e8f5e9;
            color: #38b653;
        }

        .status-inactive {
            background-color: #ffebee;
            color: #e32929;
        }

        /* Botones de acción */
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
            text-decoration: none;
            display: inline-block;
        }

        .view-btn {
            background-color: #e3f2fd;
            color: #2196f3;
        }

        .edit-btn {
            background-color: #fff3e0;
            color: #ff9800;
        }

        .delete-btn {
            background-color: #ffebee;
            color: #f44336;
        }

        /* Paginación */
        .pagination {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 5px;
        }

        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
        }

        .pagination-btn.active {
            background-color: #e32929;
            color: white;
            border-color: #e32929;
        }

        /* Estilos para modales */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        /* Estilos para el modal de detalles */
        .employee-details {
            padding: 0;
        }

        .detail-item {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #f5f5f5;
            padding-bottom: 15px;
        }

        .detail-label {
            font-weight: 600;
            width: 150px;
            color: #666;
        }

        .detail-value {
            flex: 1;
        }

        .avatar-large {
            width: 80px;
            height: 80px;
            font-size: 24px;
            margin-bottom: 15px;
        }

        /* Formularios */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-primary {
            background-color: #e32929;
            color: white;
        }

        .btn-secondary {
            background-color: #f1f1f1;
            color: #333;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .required::after {
            content: "*";
            color: #e32929;
            margin-left: 2px;
        }

        /* Filtros y búsqueda */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-group {
            flex: 1;
        }

        .search-box {
            display: flex;
        }

        .search-input {
            flex: 1;
            border-radius: 4px 0 0 4px;
            border-right: none;
        }

        .search-btn {
            background-color: #e32929;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }

        /* Mensajes de alerta */
        .flash-messages {
            margin-bottom: 20px;
        }

        .alert {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .alert-success {
            background-color: #e8f5e9;
            color: #388e3c;
            border: 1px solid #c8e6c9;
        }

        .alert-error {
            background-color: #ffebee;
            color: #d32f2f;
            border: 1px solid #ffcdd2;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }

        @media (max-width: 768px) {
            table {
                display: block;
                overflow-x: auto;
            }

            th, td {
                min-width: 120px;
            }

            .filters {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">COMICS</div>
        <nav>
            <ul class="nav-links">
                <li><a href="/productos">Productos</a></li>
                <li><a href="/empleados">Empleados</a></li>
                <li><a href="/proveedores">Proveedores</a></li>
                <li><a href="/clientes">Clientes</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <!-- Mensajes flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="table-header">
            <h2 class="section-title">Empleados</h2>
            <button onclick="mostrarModalNuevo()" class="add-employee-btn">+ Añadir empleado</button>
        </div>

        <form action="/empleados" method="get">
            <div class="filters">
                <div class="filter-group search-box">
                    <input type="text" placeholder="Buscar empleado..." class="search-input"
                           id="searchInput" name="search" value="{{ search }}">
                    <button type="submit" class="search-btn">🔍</button>
                </div>
            </div>
        </form>

        {% if error %}
        <div class="alert alert-error">
            {{ error }}
        </div>
        {% endif %}

        <div class="employees-table">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Empleado</th>
                        <th>Email</th>
                        <th>Teléfono</th>
                        <th>ID Puesto</th>
                        <th>Estado</th>
                        <th>Usuario</th>
                        <th>Fecha contratación</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="employeesTableBody">
                    {% if empleados %}
                        {% for empleado in empleados %}
                        <tr>
                            <td>{{ empleado.id_empleado }}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="employee-avatar">
                                        {{ empleado.nombre[0] }}{{ empleado.apellidos[0] if empleado.apellidos else '' }}
                                    </div>
                                    <span class="employee-name">{{ empleado.nombre }} {{ empleado.apellidos }}</span>
                                </div>
                            </td>
                            <td>{{ empleado.email }}</td>
                            <td>{{ empleado.telefono or 'No disponible' }}</td>
                            <td>{{ empleado.id_puesto }}</td>
                            <td>
                                <span class="status-tag {% if empleado.id_status == 1 %}status-active{% else %}status-inactive{% endif %}">
                                    {{ 'Activo' if empleado.id_status == 1 else 'Inactivo' }}
                                </span>
                            </td>
                            <td>{{ empleado.nombre_usuario }}</td>
                            <td>
                                {% if empleado.fecha_contratacion %}
                                    {{ empleado.fecha_contratacion }}
                                {% else %}
                                    No disponible
                                {% endif %}
                            </td>
                            <td>
                                <button onclick='verEmpleado({{ empleado|tojson|safe }})' class="action-btn view-btn">Ver</button>
                                <button type="button" onclick='editarEmpleado({{ empleado|tojson|safe }})' class="action-btn edit-btn">Editar</button>
                                <button class="action-btn delete-btn" onclick="confirmarEliminar({{ empleado.id_empleado }})">Eliminar</button>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr><td colspan="9">No hay empleados registrados.</td></tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <div class="pagination">
            {% if page > 1 %}
                <a href="/empleados?page={{ page - 1 }}&search={{ search }}"
                   class="pagination-btn">Anterior</a>
            {% else %}
                <button class="pagination-btn" disabled>Anterior</button>
            {% endif %}

            <span class="pagination-btn active">{{ page }}</span>

            <a href="/empleados?page={{ page + 1 }}&search={{ search }}"
               class="pagination-btn">Siguiente</a>
        </div>
    </div>

    <!-- Modal para confirmar eliminación -->
    <div class="modal" id="deleteModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">Confirmar eliminación</h3>
                <button class="close-modal" onclick="cerrarModal('deleteModal')">×</button>
            </div>
            <p style="margin-bottom: 20px;">¿Está seguro de que desea eliminar este empleado? Esta acción no se puede deshacer.</p>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="cerrarModal('deleteModal')" class="btn btn-secondary">Cancelar</button>
                <form id="deleteForm" method="post" action="">
                    <button type="submit" class="btn btn-primary" style="background-color: #f44336;">Eliminar</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para ver detalles del empleado -->
    <div class="modal" id="viewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detalles del Empleado</h3>
                <button class="close-modal" onclick="cerrarModal('viewModal')">×</button>
            </div>
            <div class="employee-details">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div class="employee-avatar avatar-large" style="margin: 0 auto; display: flex;">
                        <span id="viewInitials"></span>
                    </div>
                    <h2 id="viewFullName" style="margin-top: 10px;"></h2>
                </div>

                <div class="detail-item">
                    <div class="detail-label">ID:</div>
                    <div class="detail-value" id="viewId"></div>
                </div>

                <div class="detail-item">
                    <div class="detail-label">Email:</div>
                    <div class="detail-value" id="viewEmail"></div>
                </div>

                <div class="detail-item">
                    <div class="detail-label">Teléfono:</div>
                    <div class="detail-value" id="viewTelefono"></div>
                </div>

                <div class="detail-item">
                    <div class="detail-label">ID Puesto:</div>
                    <div class="detail-value" id="viewPuesto"></div>
                </div>

                <div class="detail-item">
                    <div class="detail-label">Estado:</div>
                    <div class="detail-value" id="viewEstado"></div>
                </div>

                <div class="detail-item">
                    <div class="detail-label">Nombre de usuario:</div>
                    <div class="detail-value" id="viewNombreUsuario"></div>
                </div>

                <div class="detail-item">
                    <div class="detail-label">Fecha contratación:</div>
                    <div class="detail-value" id="viewFechaContratacion"></div>
                </div>

                <div class="detail-item">
                    <div class="detail-label">Fecha nacimiento:</div>
                    <div class="detail-value" id="viewFechaNacimiento"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModal('viewModal')">Cerrar</button>
                <button class="btn btn-primary" id="btnEditarDesdeDetalle">Editar</button>
            </div>
        </div>
    </div>

    <!-- Modal para editar empleado -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="editModalTitle">Editar Empleado</h3>
                <button class="close-modal" onclick="cerrarModal('editModal')">×</button>
            </div>
            <form id="empleadoForm" method="post" onsubmit="return validarYEnviarFormulario()">
                <input type="hidden" id="id_empleado" name="id_empleado">

                <div class="form-row">
                    <div class="form-group">
                        <label for="nombre" class="required">Nombre</label>
                        <input type="text" id="nombre" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="apellidos" class="required">Apellidos</label>
                        <input type="text" id="apellidos" name="apellidos" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="email" class="required">Email</label>
                    <input type="email" id="email" name="email" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="telefono">Teléfono</label>
                        <input type="tel" id="telefono" name="telefono">
                    </div>
                    <div class="form-group">
                        <label for="id_puesto" class="required">ID Puesto</label>
                        <input type="number" id="id_puesto" name="id_puesto" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="id_status" class="required">Estado</label>
                        <select id="id_status" name="id_status" required>
                            <option value="1">Activo</option>
                            <option value="2">Inactivo</option>
                        </select>
                    </div>
                    <div class="form-group" id="nombreUsuarioGroup">
                        <label for="nombre_usuario" class="required">Nombre de usuario</label>
                        <input type="text" id="nombre_usuario" name="nombre_usuario">
                    </div>
                </div>

                <div class="form-row" id="passwordGroup">
                    <div class="form-group">
                        <label for="password" class="required">Contraseña</label>
                        <input type="password" id="password" name="password">
                    </div>
                    <div class="form-group"></div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="fecha_contratacion">Fecha de contratación</label>
                        <input type="date" id="fecha_contratacion" name="fecha_contratacion">
                    </div>
                    <div class="form-group">
                        <label for="fecha_nacimiento">Fecha de nacimiento</label>
                        <input type="date" id="fecha_nacimiento" name="fecha_nacimiento">
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal('editModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="btnGuardar">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Función para validar y enviar el formulario
        function validarYEnviarFormulario() {
            try {
                console.log("Validando formulario...");
                const form = document.getElementById('empleadoForm');
                const isNewEmployee = form.action.includes('/empleados/nuevo');
                const btnGuardar = document.getElementById('btnGuardar');

                // Desactivar el botón para prevenir múltiples envíos
                if (btnGuardar) {
                    btnGuardar.disabled = true;
                    btnGuardar.innerText = "Guardando...";
                }

                // Validar y preparar datos para el formulario según sea nuevo o edición
                if (isNewEmployee) {
                    // Para nuevo empleado, requerir nombre de usuario y contraseña
                    document.getElementById('nombre_usuario').setAttribute('required', 'required');
                    document.getElementById('password').setAttribute('required', 'required');

                    if (!document.getElementById('nombre_usuario').value || !document.getElementById('password').value) {
                        alert("El nombre de usuario y contraseña son obligatorios para nuevos empleados");
                        if (btnGuardar) {
                            btnGuardar.disabled = false;
                            btnGuardar.innerText = "Guardar";
                        }
                        return false;
                    }
                } else {
                    // Para edición, quitar requerimiento de usuario y contraseña
                    document.getElementById('nombre_usuario').removeAttribute('required');
                    document.getElementById('password').removeAttribute('required');
                }

                // Convertir campos numéricos a números
                const idPuestoEl = document.getElementById('id_puesto');
                const idStatusEl = document.getElementById('id_status');

                if (idPuestoEl && idPuestoEl.value) {
                    idPuestoEl.value = parseInt(idPuestoEl.value);
                }

                if (idStatusEl && idStatusEl.value) {
                    idStatusEl.value = parseInt(idStatusEl.value);
                }

                // Verificar campos obligatorios generales
                if (!document.getElementById('nombre').value ||
                    !document.getElementById('apellidos').value ||
                    !document.getElementById('email').value ||
                    !document.getElementById('id_puesto').value ||
                    !document.getElementById('id_status').value) {
                    alert("Por favor completa todos los campos obligatorios");
                    if (btnGuardar) {
                        btnGuardar.disabled = false;
                        btnGuardar.innerText = "Guardar";
                    }
                    return false;
                }

                // Mostrar los datos que se van a enviar para depuración
                const formData = new FormData(form);
                console.log("Datos a enviar:");
                for (let pair of formData.entries()) {
                    console.log(pair[0] + ': ' + pair[1]);
                }

                // Permitir el envío del formulario
                console.log("Formulario validado con éxito, enviando datos...");
                return true;
            } catch (error) {
                console.error("Error al validar formulario:", error);
                const btnGuardar = document.getElementById('btnGuardar');
                if (btnGuardar) {
                    btnGuardar.disabled = false;
                    btnGuardar.innerText = "Guardar";
                }
                return false;
            }
        }

        // Modal de confirmación de eliminación
        function confirmarEliminar(empleadoId) {
            const modal = document.getElementById('deleteModal');
            const form = document.getElementById('deleteForm');

            form.action = `/empleados/eliminar/${empleadoId}`;
            modal.style.display = 'flex';
        }

        // Cerrar un modal específico por su ID
        function cerrarModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
        }

        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            const modales = document.getElementsByClassName('modal');
            for (let i = 0; i < modales.length; i++) {
                if (event.target === modales[i]) {
                    modales[i].style.display = 'none';
                }
            }
        };

        // Mostrar modal para ver detalles de empleado
        function verEmpleado(empleado) {
            console.log("Ver empleado:", empleado);
            const modal = document.getElementById('viewModal');

            // Llenar datos en el modal
            document.getElementById('viewInitials').textContent = empleado.nombre[0] + (empleado.apellidos ? empleado.apellidos[0] : '');
            document.getElementById('viewFullName').textContent = empleado.nombre + ' ' + empleado.apellidos;
            document.getElementById('viewId').textContent = empleado.id_empleado;
            document.getElementById('viewEmail').textContent = empleado.email;
            document.getElementById('viewTelefono').textContent = empleado.telefono || 'No disponible';
            document.getElementById('viewPuesto').textContent = empleado.id_puesto || 'No disponible';

            // Estado con formato
            const estadoEl = document.getElementById('viewEstado');
            estadoEl.textContent = empleado.id_status === 1 ? 'Activo' : 'Inactivo';
            estadoEl.className = empleado.id_status === 1 ? 'status-tag status-active' : 'status-tag status-inactive';

            document.getElementById('viewNombreUsuario').textContent = empleado.nombre_usuario || 'No disponible';
            document.getElementById('viewFechaContratacion').textContent = empleado.fecha_contratacion || 'No disponible';
            document.getElementById('viewFechaNacimiento').textContent = empleado.fecha_nacimiento || 'No disponible';

            // Configurar botón para editar desde detalles
            document.getElementById('btnEditarDesdeDetalle').onclick = function() {
                cerrarModal('viewModal');
                editarEmpleado(empleado);
            };

            // Mostrar modal
            modal.style.display = 'flex';
        }

        // Mostrar modal para editar empleado
        function editarEmpleado(empleado) {
            // Depuración completa de los datos recibidos
            console.log("------ EDITAR EMPLEADO ------");
            console.log("Datos recibidos:", JSON.stringify(empleado, null, 2));

            try {
                const modal = document.getElementById('editModal');
                const form = document.getElementById('empleadoForm');

                // Verificar que el modal y el formulario existen
                if (!modal || !form) {
                    console.error("No se encontró el modal o el formulario");
                    return;
                }

                console.log("Configurando formulario para edición...");

                // Configurar título del modal y URL del formulario
                const titleEl = document.getElementById('editModalTitle');
                if (titleEl) {
                    titleEl.textContent = 'Editar Empleado';
                }

                // Configurar la acción del formulario
                form.action = `/empleados/editar/${empleado.id_empleado}`;
                console.log("URL del formulario configurada:", form.action);

                // Asegúrate de que los valores numéricos sean de tipo número
                const idEmpleado = typeof empleado.id_empleado === 'string' ?
                    parseInt(empleado.id_empleado) : empleado.id_empleado;
                const idPuesto = typeof empleado.id_puesto === 'string' ?
                    parseInt(empleado.id_puesto) : empleado.id_puesto;
                const idStatus = typeof empleado.id_status === 'string' ?
                    parseInt(empleado.id_status) : empleado.id_status;

                console.log("Valores convertidos:", {
                    idEmpleado: idEmpleado,
                    idPuesto: idPuesto,
                    idStatus: idStatus
                });

                // Llenar el formulario con los datos del empleado
                const camposFormulario = {
                    'id_empleado': idEmpleado,
                    'nombre': empleado.nombre || '',
                    'apellidos': empleado.apellidos || '',
                    'email': empleado.email || '',
                    'telefono': empleado.telefono || '',
                    'id_puesto': idPuesto || '',
                    'id_status': idStatus === undefined || idStatus === null ? 1 : idStatus
                };

                console.log("Valores a colocar en el formulario:", camposFormulario);

                // Asignar valores a los campos del formulario
                for (const [id, valor] of Object.entries(camposFormulario)) {
                    const campo = document.getElementById(id);
                    if (campo) {
                        campo.value = valor;
                        console.log(`Campo ${id} establecido a: ${valor}`);
                    } else {
                        console.warn(`No se encontró el campo con ID: ${id}`);
                    }
                }

                // Ocultar los campos de nombre_usuario y password (solo necesarios para nuevo empleado)
                const usuarioGroup = document.getElementById('nombreUsuarioGroup');
                const passwordGroup = document.getElementById('passwordGroup');

                if (usuarioGroup) usuarioGroup.style.display = 'none';
                if (passwordGroup) passwordGroup.style.display = 'none';

                // Eliminar la validación required para campos que no se usarán en edición
                const usuarioInput = document.getElementById('nombre_usuario');
                const passwordInput = document.getElementById('password');

                if (usuarioInput) usuarioInput.removeAttribute('required');
                if (passwordInput) passwordInput.removeAttribute('required');

                // Formatear fecha para el input date si existe
                if (empleado.fecha_contratacion) {
                    try {
                        // Comprobar diferentes formatos de fecha
                        let fechaFormateada = '';
                        if (empleado.fecha_contratacion.includes('/')) {
                            // Formato DD/MM/YYYY
                            let fechaPartes = empleado.fecha_contratacion.split('/');
                            if (fechaPartes.length === 3) {
                                fechaFormateada = `${fechaPartes[2]}-${fechaPartes[1].padStart(2, '0')}-${fechaPartes[0].padStart(2, '0')}`;
                            }
                        } else if (empleado.fecha_contratacion.includes('-')) {
                            // Ya podría estar en formato YYYY-MM-DD, comprobar
                            const fechaPartes = empleado.fecha_contratacion.split('-');
                            if (fechaPartes.length === 3 && fechaPartes[0].length === 4) {
                                // Ya está en formato YYYY-MM-DD
                                fechaFormateada = empleado.fecha_contratacion;
                            } else if (fechaPartes.length === 3) {
                                // Podría ser DD-MM-YYYY
                                fechaFormateada = `${fechaPartes[2]}-${fechaPartes[1].padStart(2, '0')}-${fechaPartes[0].padStart(2, '0')}`;
                            }
                        }

                        const fechaContratacionEl = document.getElementById('fecha_contratacion');
                        if (fechaContratacionEl) {
                            fechaContratacionEl.value = fechaFormateada;
                            console.log("Fecha contratación formateada:", fechaFormateada);
                        }
                    } catch (e) {
                        console.error("Error al formatear fecha_contratacion:", e);
                        const fechaContratacionEl = document.getElementById('fecha_contratacion');
                        if (fechaContratacionEl) fechaContratacionEl.value = '';
                    }
                } else {
                    const fechaContratacionEl = document.getElementById('fecha_contratacion');
                    if (fechaContratacionEl) fechaContratacionEl.value = '';
                }

                // Formatear fecha de nacimiento - mismo proceso
                if (empleado.fecha_nacimiento) {
                    try {
                        let fechaFormateada = '';
                        if (empleado.fecha_nacimiento.includes('/')) {
                            let fechaPartes = empleado.fecha_nacimiento.split('/');
                            if (fechaPartes.length === 3) {
                                fechaFormateada = `${fechaPartes[2]}-${fechaPartes[1].padStart(2, '0')}-${fechaPartes[0].padStart(2, '0')}`;
                            }
                        } else if (empleado.fecha_nacimiento.includes('-')) {
                            const fechaPartes = empleado.fecha_nacimiento.split('-');
                            if (fechaPartes.length === 3 && fechaPartes[0].length === 4) {
                                fechaFormateada = empleado.fecha_nacimiento;
                            } else if (fechaPartes.length === 3) {
                                fechaFormateada = `${fechaPartes[2]}-${fechaPartes[1].padStart(2, '0')}-${fechaPartes[0].padStart(2, '0')}`;
                            }
                        }

                        const fechaNacimientoEl = document.getElementById('fecha_nacimiento');
                        if (fechaNacimientoEl) {
                            fechaNacimientoEl.value = fechaFormateada;
                            console.log("Fecha nacimiento formateada:", fechaFormateada);
                        }
                    } catch (e) {
                        console.error("Error al formatear fecha_nacimiento:", e);
                        const fechaNacimientoEl = document.getElementById('fecha_nacimiento');
                        if (fechaNacimientoEl) fechaNacimientoEl.value = '';
                    }
                } else {
                    const fechaNacimientoEl = document.getElementById('fecha_nacimiento');
                    if (fechaNacimientoEl) fechaNacimientoEl.value = '';
                }

                // Restablecer estado del botón
                const btnGuardar = document.getElementById('btnGuardar');
                if (btnGuardar) {
                    btnGuardar.disabled = false;
                    btnGuardar.innerText = "Guardar";
                }

                console.log("Mostrando modal de edición...");

                // Mostrar modal
                modal.style.display = 'flex';
                console.log("Modal mostrado con éxito");
            } catch (error) {
                console.error("Error al preparar formulario de edición:", error);
                alert("Ocurrió un error al cargar los datos del empleado: " + error.message);
            }
        }

        // Mostrar modal para nuevo empleado
        function mostrarModalNuevo() {
            try {
                const modal = document.getElementById('editModal');
                const form = document.getElementById('empleadoForm');

                // Configurar título del modal y URL del formulario
                document.getElementById('editModalTitle').textContent = 'Nuevo Empleado';
                form.action = '/empleados/nuevo';

                // Limpiar formulario
                form.reset();
                document.getElementById('id_empleado').value = '';

                // Establecer valores predeterminados
                document.getElementById('id_status').value = "1";  // Activo por defecto

                // Mostrar los campos de nombre_usuario y password (obligatorios para nuevo empleado)
                document.getElementById('nombreUsuarioGroup').style.display = 'block';
                document.getElementById('passwordGroup').style.display = 'flex';

                // Los campos de usuario y contraseña son requeridos para nuevo empleado
                document.getElementById('nombre_usuario').setAttribute('required', 'required');
                document.getElementById('password').setAttribute('required', 'required');

                // Restablecer estado del botón
                const btnGuardar = document.getElementById('btnGuardar');
                if (btnGuardar) {
                    btnGuardar.disabled = false;
                    btnGuardar.innerText = "Guardar";
                }

                // Mostrar modal
                modal.style.display = 'flex';
            } catch (error) {
                console.error("Error al preparar formulario de nuevo empleado:", error);
                alert("Ocurrió un error al preparar el formulario. Por favor, inténtalo de nuevo.");
            }
        }
    </script>
</body>
</html>